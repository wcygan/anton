machine:
  # WHY: Route Harbor pulls to internal Kubernetes service for speed.
  # The LoadBalancer IP (192.168.1.105) is the externalURL / auth realm.
  # containerd mirrors this to the ClusterIP for fast in-cluster pulls.
  registries:
    mirrors:
      192.168.1.105:
        endpoints:
          - http://harbor.harbor.svc.cluster.local
    config:
      harbor.harbor.svc.cluster.local:
        auth:
          username: ${HARBOR_ROBOT_USERNAME}
          password: ${HARBOR_ROBOT_PASSWORD}
  network:
    disableSearchDomain: true
    nameservers:
      - 192.168.1.254
      - 1.1.1.1
      - 1.0.0.1
    extraHostEntries:
      # WHY: containerd runs on the node, not in a pod, so it can't resolve
      # Kubernetes service names. Add static entry for the internal mirror.
      - ip: 10.43.216.243
        aliases:
          - harbor.harbor.svc.cluster.local
