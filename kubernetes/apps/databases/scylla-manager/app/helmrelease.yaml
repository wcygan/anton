---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: scylla-manager
  namespace: scylla-manager
spec:
  targetNamespace: scylla-manager
  chart:
    spec:
      chart: scylla-manager
      version: v1.19.1
      sourceRef:
        kind: HelmRepository
        name: scylla
  interval: 1h
  timeout: 10m
  install:
    remediation:
      retries: 3
    disableWait: true
  upgrade:
    cleanupOnFail: true
    remediation:
      retries: 3
  values:
    # Scylla Manager configuration
    # Manages backup, repair, and maintenance tasks for ScyllaClusters

    # Manager resource limits
    resources:
      limits:
        cpu: 200m
        memory: 128Mi
      requests:
        cpu: 10m
        memory: 32Mi

    # Internal Scylla cluster configuration
    scylla:
      developerMode: true
      datacenter: dc1
      racks:
        - name: rack1
          members: 1
          storage:
            capacity: 2Gi
            storageClassName: ceph-block
          resources:
            requests:
              cpu: 500m
              memory: 512Mi
            limits:
              cpu: 1000m
              memory: 1Gi
          # Remove node affinity requirement - allow scheduling on any node
          placement: {}
